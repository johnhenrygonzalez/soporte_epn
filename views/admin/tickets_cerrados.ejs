<!-- ========== TARJETA TICKETS CERRADOS ========== -->

<!-- üåü ENCABEZADO UNIVERSAL: LOGO IZQUIERDA + T√çTULO CENTRADO -->
<div class="encabezado-admin d-flex align-items-center justify-content-between">

  <!-- LOGO IZQUIERDA -->
  <div class="encabezado-logo">
    <% if (logo) { %>
      <img 
        src="/uploads/<%= logo %>" 
        alt="Logo institucional"
        class="logo-admin"
      >
    <% } %>
  </div>

  <!-- T√çTULO Y USUARIO -->
  <div class="encabezado-titulos flex-grow-1 text-center">
    <h2 class="titulo-admin">
      <i class="fas fa-ticket-alt"></i> Tickets Cerrados
    </h2>
    <p class="subtitulo-admin">
      <%= (usuarioSesion && usuarioSesion.nombre) || 'Administrador' %>
    </p>
  </div>

  <!-- ESPACIADOR DERECHO -->
  <div class="encabezado-espaciador"></div>

</div>


<!-- ================= FILTROS ================= -->
<section class="filtros">
  <form method="get" action="/admin/tickets/cerrados" class="form-filtros">

    <!-- FILTRO POR ID -->
    <input type="number"
       name="ticket_id"
       placeholder="ID del ticket"
       value="<%= filtros.ticket_id || '' %>"
       class="input-id">

    <!-- FILTRO POR T√âCNICO -->
    <select name="tecnico_id">
      <option value="">Todos los t√©cnicos</option>
      <% tecnicos.forEach(tec => { %>
        <option value="<%= tec.id %>" <%= filtros.tecnico_id == tec.id ? 'selected' : '' %> >
          <%= tec.nombre %>
        </option>
      <% }) %>
    </select>

    <!-- FECHA DESDE -->
    <input type="date"
           name="fecha_desde"
           value="<%= filtros.fecha_desde || '' %>">

    <!-- FECHA HASTA -->
    <input type="date"
           name="fecha_hasta"
           value="<%= filtros.fecha_hasta || '' %>">

    <button type="submit" class="btn-filtrar">üîç Filtrar</button>

    <!-- BOT√ìN LIMPIAR -->
    <a href="/admin/tickets/cerrados" class="btn-limpiar">‚ü≥ Limpiar</a>

  </form>
</section>


<!-- ================= TABLA ================= -->
<main>
  <% if (tickets.length > 0) { %>
    <table class="tabla">
      <thead>
        <tr>
          <th class="text-center">ID</th>
          <th class="text-center">Solicitante</th>
          <th class="text-center">T√©cnico</th>
          <th class="text-center">Fecha de Cierre</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>

      <tbody>
        <% tickets.forEach(ticket => { %>
        <tr>
          <td class="text-center"><%= ticket.id %></td>
          <td class="text-center"><%= ticket.nombre %></td>
          <td class="text-center"><%= ticket.tecnico || "Sin t√©cnico" %></td>
          <td class="text-center"><%= new Date(ticket.fecha_cierre).toLocaleString("es-ES") %></td>

          <td class="text-center">
            <a href="/admin/ticket/<%= ticket.id %>/historial" class="btn-historial">
              üìú Historial
            </a>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <div class="sin-registros">No hay tickets cerrados.</div>
  <% } %>
</main>

<div class="mt-3">
  <a href="/admin" (cambiar solo esto por ruta correcta)
    class="fw-bold text-decoration-none">
    ‚¨Ö Volver al Menu
  </a>
</div>

<!-- ================= PAGINACI√ìN ================= -->
<div class="paginacion">
  <% for (let i = 1; i <= totalPaginas; i++) { %>
    <a 
      href="?pagina=<%= i %>&tecnico_id=<%= filtros.tecnico_id || '' %>&fecha_desde=<%= filtros.fecha_desde || '' %>&fecha_hasta=<%= filtros.fecha_hasta || '' %>"
      class="pagina <%= pagina === i ? 'activa' : '' %>"
    >
      <%= i %>
    </a>
  <% } %>
  
</div>


<!-- ================= ESTILOS ================= -->
<style>

  /* üåü ENCABEZADO UNIVERSAL */
  .encabezado-admin {
    background: #ffffff;
    padding: 20px;
    margin: 20px auto 20px auto;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    max-width: 1500px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .encabezado-logo {
    width: 120px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .logo-admin {
    width: 85px;
    height: 85px;
    object-fit: contain;
  }

  .encabezado-titulos {
    flex-grow: 1;
    text-align: center;
  }

  .titulo-admin {
    font-size: 28px;
    margin: 0;
    font-weight: bold;
    color: #222;
  }

  .subtitulo-admin {
    font-size: 15px;
    color: #555;
    margin-top: 5px;
  }

  .encabezado-espaciador {
    width: 120px;
  }

  /* ==================== FILTROS ==================== */
  .filtros {
    margin: 20px auto;
    text-align: center;
  }
  .form-filtros select,
  .form-filtros input[type='date'] {
    padding: 8px;
    margin: 5px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  .btn-filtrar {
    padding: 8px 12px;
    background: #0d6efd;
    color: white;
    border-radius: 6px;
    border: none;
    cursor: pointer;
  }
  .btn-limpiar {
    padding: 8px 12px;
    background: #6c757d;
    color: white;
    border-radius: 6px;
    text-decoration: none;
  }

  /* ==================== TABLA ==================== */
  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
  }
  th {
    background: #020202;
    padding: 12px;
    color: white;
  }
  td {
    padding: 10px;
  }
  tr:nth-child(even) {
    background: #f7f7f7;
  }

  .btn-historial {
    background: #0dcaf0;
    padding: 6px 10px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: bold;
  }

  /* ==================== PAGINACI√ìN ==================== */
  .paginacion {
    margin-top: 20px;
    text-align: center;
  }
  .pagina {
    padding: 6px 12px;
    margin: 3px;
    display: inline-block;
    background: #e9ecef;
    border-radius: 6px;
    text-decoration: none;
  }
  .pagina.activa {
    background: #3c3d3d;
    color: white;
    font-weight: bold;
  }

</style>
